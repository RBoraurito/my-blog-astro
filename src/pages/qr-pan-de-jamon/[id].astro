---
import { getEntry, getCollection, render } from 'astro:content'
import PanDeJamon from '@layouts/pan-de-jamon.astro'
import { Container } from '@components/Container'
import { Prose } from '@components/Prose'
import Image from '@components/Image.astro'

export async function getStaticPaths() {
  const instructions = await getCollection('instructions')
  return instructions.map((instruction: any) => ({
    params: {
      id: instruction.id,
    },
  }))
}

const { id } = Astro.params
const instruction = await getEntry('instructions', id)

if (!instruction) {
  // Handle Error, for example:
  throw new Error('Could not find instruction')
}

const meta = {
  id: instruction.id,
  metaTitle: instruction.data.metaTitle,
  metaDescription: instruction.data.metaDescription,
  metaImage: instruction.data.metaImage,
}

const { Content } = await render(instruction)
---

<PanDeJamon title={meta.metaTitle} description={meta.metaDescription} image={meta.metaImage}>
  <Container className="py-12 lg:py-20">
    <Image src={meta.metaImage} alt={meta.metaTitle} class="mb-4 h-44 rounded-t-lg object-cover" />
    <h1 class="text-3xl text-amber-50 lg:text-4xl">{meta.metaTitle}</h1>
    <Prose className="prose-jamon">
      <Content />
    </Prose>
  </Container>
</PanDeJamon>
